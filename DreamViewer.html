<!DOCTYPE html>
<html lang="zh-CN"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>织梦者 - 你未来的自己</title>
<link href="data:image/x-icon;base64," rel="icon" type="image/x-icon"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries,typography"></script>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Spline+Sans:wght@400;500;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<style type="text/tailwindcss">
    :root {
      --primary-color: #38e07b;
      --secondary-color: #1a2e22;
      --background-color: #121212;
      --text-primary: #e0e0e0;
      --text-secondary: #a0a0a0;
      --accent-color: #6ee7b7;
      --radius-sm: 0.125rem;
      --radius-md: 0.375rem;
      --radius-lg: 0.5rem;
      --radius-xl: 0.75rem;
      --radius-2xl: 1rem;
      --radius-3xl: 1.5rem;
      --radius-full: 9999px;
    }
    body {
      font-family: 'Spline Sans', sans-serif;
    }
  </style>
</head>
<body class="bg-[var(--background-color)] text-[var(--text-primary)]">
<div class="flex flex-col min-h-screen">
<header class="sticky top-0 z-10 bg-[var(--background-color)]/80 backdrop-blur-sm border-b border-white/10">
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
<div class="flex items-center justify-between h-16">
<div class="flex items-center gap-4">
<span class="material-symbols-outlined text-[var(--primary-color)] text-3xl">
              auto_awesome
            </span>
<h1 class="text-xl font-bold text-white">织梦者</h1>
</div>
<nav class="hidden md:flex items-center gap-8">
<a class="text-sm font-medium text-[var(--text-secondary)] hover:text-white transition-colors" href="#">首页</a>
</nav>
<div class="flex items-center gap-4">
<button class="relative rounded-full p-2 text-[var(--text-secondary)] hover:bg-[var(--secondary-color)] hover:text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-[var(--background-color)] focus:ring-[var(--primary-color)]">
<span class="material-symbols-outlined">
                notifications
              </span>
</button>
<div class="flex-shrink-0">
<img alt="User profile" class="h-10 w-10 rounded-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuC_c51tkVG92vI0A8hjWFt-IC32i0gcwO4o0P25whZwb02-LveD0cQzd6t33LBAfgFOpMVPNB7b9U8XlRPlbXImcshzI6MVMFdynHf5NfjRGCVTChMckZC-SD6LEFJep5qyPQeQL4lgMAHfeS6C80B9-6Gqf23GKn6DRYcJjq89R6L5gJIea8aIXQ48ksiqSUuTyOmu2wSmnYZO5N74Vybix5bLbugqLgYm-84Uy4c3yUOOytwJvQQ3hb3Fev2ReCn2qMwxrQI4srGQ"/>
</div>
</div>
</div>
</div>
</header>
<main class="flex-grow">
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
<div class="text-center mb-12">
<h2 class="text-4xl md:text-5xl font-extrabold tracking-tight text-white">你未来的自己正在等待！</h2>
<div class="mt-4 flex items-center justify-center gap-3 text-lg text-[var(--text-secondary)]">
<span class="material-symbols-outlined text-[var(--accent-color)]">spark</span>
<span>一窥你光明的前景</span>
<span class="material-symbols-outlined text-[var(--accent-color)]">spark</span>
</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<div id="dream-container" class="bg-[var(--secondary-color)] rounded-[var(--radius-2xl)] shadow-2xl shadow-black/30 overflow-hidden border border-white/10">
<div class="grid grid-cols-1 md:grid-cols-5">
<div class="md:col-span-3">
<div class="aspect-[4/5] bg-cover bg-center" style="background-image: url('{{ url_for('uploaded_file', filename=image_filename) }}');"></div>
</div>
<div class="md:col-span-2 p-8 flex flex-col justify-center bg-gradient-to-br from-[var(--secondary-color)] to-black/20">
<div class="space-y-6">
<h3 class="text-2xl font-bold text-white leading-tight">恭喜你, {{ name }}!</h3>
<div id="generated-text-container" class="text-[var(--text-secondary)] leading-relaxed prose prose-invert"></div>
                <script>
                  const generatedText = `{{ generated_text | safe }}`;
                  document.getElementById('generated-text-container').innerHTML =
                    marked.parse(generatedText);
                </script>
</div>
</div>
</div>
</div>
<div class="mt-12 text-center flex justify-center gap-4">
<button id="share-btn" class="bg-[var(--primary-color)] text-[var(--background-color)] px-8 py-4 rounded-[var(--radius-full)] font-bold text-lg hover:bg-[var(--accent-color)] transition-all duration-300 transform hover:scale-105 shadow-lg shadow-[var(--primary-color)]/20 flex items-center gap-3 mx-auto">
<span class="material-symbols-outlined">
              share
            </span>
<span>分享你的梦想</span>
</button>
</div>

<!-- QR Code Modal -->
<div id="qr-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center" style="display: none;">
  <div class="bg-white p-4 rounded-lg shadow-lg">
    <img id="qr-code-image" src="" alt="QR Code" />
  </div>
</div>

<div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50" style="display: none;">
    <div class="text-center">
        <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-[var(--primary-color)]"></div>
        <p class="mt-4 text-lg font-semibold text-white">程序正在运行，请稍候...</p>
    </div>
</div>

<script>
  document.getElementById('share-btn').addEventListener('click', function() {
    document.getElementById('loading-overlay').style.display = 'flex';
    const imageFilename = '{{ image_filename }}';
    const generatedText = document.getElementById('generated-text-container').innerText;

    fetch('/share', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        image_filename: imageFilename,
        text: generatedText
      }),
    })
    .then(response => response.json())
    .then(data => {
      document.getElementById('loading-overlay').style.display = 'none';
      if (data.qr_code_url) {
        const modal = document.getElementById('qr-modal');
        const qrImage = document.getElementById('qr-code-image');
        qrImage.src = data.qr_code_url;
        modal.style.display = 'flex';
      } else {
        console.error('Error sharing dream:', data.error);
        alert('分享失败，请稍后再试。');
      }
    })
    .catch(error => {
      document.getElementById('loading-overlay').style.display = 'none';
      console.error('Fetch error:', error);
      alert('分享请求失败，请检查网络连接。');
    });
  });

  document.getElementById('qr-modal').addEventListener('click', function(e) {
    if (e.target.id === 'qr-modal') {
      this.style.display = 'none';
    }
  });
</script>
</div>
</main>
<footer class="bg-black/20 mt-16">
<div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-sm text-[var(--text-secondary)]">
<p>© 2024 织梦者. 版权所有.</p>
</div>
</footer>
</div>

</body></html>